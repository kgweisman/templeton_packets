filter(subscale != "invo_hardy_bentall_p3") %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry") %>%
cor() %>%
data.frame()
temp_fa <- psych::fa(temp, nfactors = 9, rotate = "none")
temp_fa <- psych::fa(temp, nfactors = 6, rotate = "none")
temp_fa <- psych::fa(temp, nfactors = 5, rotate = "none")
temp_fa <- psych::fa(temp, nfactors = 4, rotate = "none")
temp_fa <- psych::fa(temp, nfactors = 4, rotate = "none"); temp_fa
temp_fa <- psych::fa(temp, nfactors = 4, rotate = "varimax"); fa.sort(temp_fa)
temp <- d_long_subscale_boot %>%
mutate(subscale = ifelse(grepl("invo_hardy_bentall", subscale),
paste(subscale,
gsub("packet ", "p", packet),
sep = "_"),
subscale)) %>%
distinct(ctry, subscale, Mean) %>%
filter(subscale != "invo_hardy_bentall_p3") %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry") %>%
cor() %>%
data.frame()
temp_fa <- psych::fa(temp, nfactors = 4, rotate = "varimax"); fa.sort(temp_fa)
library(psych)
temp_fa <- fa(temp, nfactors = 4, rotate = "varimax"); fa.sort(temp_fa)
temp_fa <- fa(temp, nfactors = 5, rotate = "varimax"); fa.sort(temp_fa)
temp_fa <- fa(temp, nfactors = 3, rotate = "varimax"); fa.sort(temp_fa)
temp_fa <- fa(temp, nfactors = 3, rotate = "oblimin"); fa.sort(temp_fa)
temp_fa <- fa(temp, nfactors = 9, rotate = "oblimin"); fa.sort(temp_fa)
?fa
temp <- d_long_subscale_boot %>%
mutate(subscale = ifelse(grepl("invo_hardy_bentall", subscale),
paste(subscale,
gsub("packet ", "p", packet),
sep = "_"),
subscale)) %>%
distinct(ctry, subscale, Mean) %>%
filter(subscale != "invo_hardy_bentall_p3") %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry") %>%
cor() %>%
matrix()
library(psych)
fa.parallel(temp)
temp
temp <- d_long_subscale_boot %>%
mutate(subscale = ifelse(grepl("invo_hardy_bentall", subscale),
paste(subscale,
gsub("packet ", "p", packet),
sep = "_"),
subscale)) %>%
distinct(ctry, subscale, Mean) %>%
filter(subscale != "invo_hardy_bentall_p3") %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry") %>%
cor() %>%
as.matrix()
# library(psych)
fa.parallel(temp)
temp <- d_long_subscale_boot %>%
mutate(subscale = ifelse(grepl("invo_hardy_bentall", subscale),
paste(subscale,
gsub("packet ", "p", packet),
sep = "_"),
subscale)) %>%
distinct(ctry, subscale, Mean) %>%
filter(subscale != "invo_hardy_bentall_p3") %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry")
glimpse(temp)
# library(psych)
fa.parallel(temp)
# library(psych)
VSS(temp)
?VSS
# library(psych)
VSS(temp, rotate = "oblimin")
glimpse(temp)
# library(psych)
fa(temp, nfactors = 9, rotate = "none")
# library(psych)
fa(temp, nfactors = 5, rotate = "none")
# library(psych)
fa(temp, nfactors = 4, rotate = "none")
# library(psych)
fa(temp, nfactors = 4, rotate = "none") %>% fa.sort()
View(temp)
# library(psych)
hclust(temp)
?hclust
# library(psych)
hclust(dist(temp))
# library(psych)
hclust(dist(temp)) %>% plot()
# library(psych)
hclust(dist(t(temp))) %>% plot()
# library(psych)
hclust(dist(temp)) %>% plot()
hclust(dist(t(temp))) %>% plot()
temp <- d_long_subscale_boot %>%
mutate(subscale = ifelse(grepl("invo_hardy_bentall", subscale),
paste(subscale,
gsub("packet ", "p", packet),
sep = "_"),
subscale)) %>%
distinct(ctry, subscale, Mean) %>%
filter(subscale != "invo_hardy_bentall_p3") %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry")
# library(psych)
hclust(dist(temp)) %>% plot()
hclust(dist(t(temp))) %>% plot()
# set working director
# setwd("/Users/kweisman/Documents/Research (Stanford)/Projects/Templeton Grant/DATA WRANGLING/templeton_packets/packets123/")
# load packages
library(tidyverse)
library(rms)
# load question key (including manual reverse-coding)
question_key <- read.csv("//Users/kweisman/Documents/Research (Stanford)/Projects/Templeton Grant/DATA WRANGLING/templeton_packets/packets123/packets123_question_key_byhand.csv")
# load data
d_wide <- read_csv("./packets123_data_byquestion_wide.csv")
d_wide_subscale <- read_csv("./packets123_data_bysubscale_wide.csv")
d_long <- read_csv("./packets123_data_byquestion_long.csv")
d_long_subscale <- read_csv("./packets123_data_bysubscale_long.csv")
# make custom functions
round2 <- function(x) {format(round(x, 2), digits = 2)}
d_long_subscale_boot <- d_long_subscale %>%
filter(!is.na(sum_score)) %>%
group_by(ctry, packet, subscale) %>%
do(data.frame(rbind(smean.cl.boot(.$sum_score)))) %>%
ungroup() %>%
filter(subscale != "attn") %>%
left_join(d_long_subscale %>%
filter(!is.na(sum_score)) %>%
count(ctry, packet, subscale)) %>%
mutate(packet = paste("packet", packet),
ctry = factor(ctry,
levels = c("us", "ghana",
"thailand", "china", "vanuatu")))
ggplot(d_long_subscale_boot,
aes(x = ctry, y = Mean, color = ctry)) +
facet_wrap(~ reorder(interaction(packet, subscale, sep = ": "),
as.numeric(factor(packet))),
scales = "free") +
geom_pointrange(aes(ymin = Lower, ymax = Upper)) +
geom_text(aes(label = paste0("(n=", n, ")"), y = Lower),
size = 2, nudge_x = 0.15, hjust = 0) +
scale_x_discrete(expand = c(0, 1)) +
scale_color_brewer(palette = "Dark2") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1),
legend.position = "top") +
labs(title = "mean scores by site",
subtitle = "ordered by packet\nerror bars are bootstrapped 95% confidence intervals",
x = "site", color = "site",
y = "mean score (range varies by subscale)")
d_long_subscale_boot %>%
mutate(subscale = ifelse(grepl("invo_hardy_bentall", subscale),
paste(subscale,
gsub("packet ", "p", packet),
sep = "_"),
subscale)) %>%
distinct(ctry, subscale, Mean) %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry") %>%
cor() %>%
data.frame() %>%
rownames_to_column("subscaleA") %>%
gather(subscaleB, cor, -subscaleA) %>%
ggplot(aes(x = subscaleA, y = subscaleB, fill = cor, label = round2(cor))) +
geom_tile() +
geom_text(size = 3) +
scale_fill_distiller(guide = guide_colorbar(barheight = 6),
palette = "RdYlBu", limits = c(-1, 1)) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(title = "correlations among mean subscale scores, by site",
x = "",
y = "")
temp <- d_long_subscale_boot %>%
mutate(subscale = ifelse(grepl("invo_hardy_bentall", subscale),
paste(subscale,
gsub("packet ", "p", packet),
sep = "_"),
subscale)) %>%
distinct(ctry, subscale, Mean) %>%
filter(subscale != "invo_hardy_bentall_p3") %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry")
hclust(dist(t(temp))) %>% plot()
hclust(dist(temp)) %>% plot()
d_long_subscale %>%
filter(packet == 1, !is.na(sum_score)) %>%
spread(subscale, sum_score) %>%
select(-c(ctry, wher, recr, whoc, attn)) %>%
mutate(subj = paste(subj, packet, version, sep = "_")) %>%
select(-packet, -version) %>%
distinct() %>%
remove_rownames() %>%
column_to_rownames("subj") %>%
cor(use = "pairwise.complete.obs") %>%
data.frame() %>%
rownames_to_column("subscaleA") %>%
gather(subscaleB, cor, -subscaleA) %>%
ggplot(aes(x = subscaleA, y = subscaleB, fill = cor, label = round2(cor))) +
geom_tile() +
geom_text(size = 3) +
scale_fill_distiller(guide = guide_colorbar(barheight = 6),
palette = "RdYlBu", limits = c(-1, 1)) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(title = "PACKET 1: correlations among subscales",
subtitle = "using pairwise complete observations",
x = "",
y = "")
d_long_subscale %>%
filter(packet == 2, !is.na(sum_score)) %>%
spread(subscale, sum_score) %>%
select(-c(ctry, wher, recr, whoc, attn)) %>%
mutate(subj = paste(subj, packet, version, sep = "_")) %>%
select(-packet, -version) %>%
distinct() %>%
remove_rownames() %>%
column_to_rownames("subj") %>%
cor(use = "pairwise.complete.obs") %>%
data.frame() %>%
rownames_to_column("subscaleA") %>%
gather(subscaleB, cor, -subscaleA) %>%
ggplot(aes(x = subscaleA, y = subscaleB, fill = cor, label = round2(cor))) +
geom_tile() +
geom_text(size = 3) +
scale_fill_distiller(guide = guide_colorbar(barheight = 6),
palette = "RdYlBu", limits = c(-1, 1)) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(title = "PACKET 2: correlations among subscales",
subtitle = "using pairwise complete observations\nordered by hierarchical clustering",
x = "",
y = "")
d_long_subscale %>%
filter(packet == 3, !is.na(sum_score)) %>%
spread(subscale, sum_score) %>%
select(-c(ctry, wher, recr, whoc, attn)) %>%
mutate(subj = paste(subj, packet, version, sep = "_")) %>%
select(-packet, -version) %>%
distinct() %>%
remove_rownames() %>%
column_to_rownames("subj") %>%
cor(use = "pairwise.complete.obs") %>%
data.frame() %>%
rownames_to_column("subscaleA") %>%
gather(subscaleB, cor, -subscaleA) %>%
ggplot(aes(x = subscaleA, y = subscaleB, fill = cor, label = round2(cor))) +
geom_tile() +
geom_text(size = 3) +
scale_fill_distiller(guide = guide_colorbar(barheight = 6),
palette = "RdYlBu", limits = c(-1, 1)) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(title = "PACKET 3: correlations among subscales",
subtitle = "using pairwise complete observations",
x = "",
y = "")
d_long_subscale %>%
spread(subscale, sum_score) %>%
select(-c(ctry, wher, recr, whoc, attn)) %>%
mutate(subj = paste(subj, packet, version, sep = "_")) %>%
select(-packet, -version) %>%
distinct() %>%
remove_rownames() %>%
column_to_rownames("subj") %>%
cor(use = "pairwise.complete.obs") %>%
data.frame() %>%
rownames_to_column("subscaleA") %>%
gather(subscaleB, cor, -subscaleA) %>%
ggplot(aes(x = subscaleA, y = subscaleB, fill = cor, label = round2(cor))) +
geom_tile() +
geom_text(size = 3) +
scale_fill_distiller(guide = guide_colorbar(barheight = 6),
palette = "RdYlBu", limits = c(-1, 1)) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(title = "PACKETS 1-3: correlations among subscales",
subtitle = "using pairwise complete observations",
x = "",
y = "")
temp
cor_by_site <- d_long_subscale_boot %>%
mutate(subscale = ifelse(grepl("invo_hardy_bentall", subscale),
paste(subscale,
gsub("packet ", "p", packet),
sep = "_"),
subscale)) %>%
distinct(ctry, subscale, Mean) %>%
filter(subscale != "invo_hardy_bentall_p3") %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry")
hclust(dist(t(cor_by_site))) %>% qplot()
clust_subscales <- hclust(dist(t(cor_by_site)))
clust_subscales
clust_subscales$height
install.packages("ggdendro")
library(ggdendro)
clust_subscales <- hclust(dist(t(cor_by_site)))
ggdendrogram(clust_subscales)
clust_subscales <- hclust(dist(t(cor_by_site)))
ggdendrogram(clust_subscales)
clust_subscales <- hclust(dist(t(cor_by_site)))
ggdendrogram(clust_subscales)
clust_subscales <- hclust(dist(t(cor_by_site)))
ggdendrogram(clust_subscales) +
labs(title = "hierarchical cluster of subscales",
subtitle = "using mean scores by site")
cor_by_site <- d_long_subscale_boot %>%
mutate(subscale = ifelse(grepl("invo_hardy_bentall", subscale),
paste(subscale,
gsub("packet ", "p", packet),
sep = "_"),
subscale)) %>%
distinct(ctry, subscale, Mean) %>%
filter(subscale != "invo_hardy_bentall_p3") %>%
ungroup() %>%
spread(subscale, Mean) %>%
data.frame() %>%
column_to_rownames("ctry")
clust_subscales <- hclust(dist(t(cor_by_site)))
ggdendrogram(clust_subscales) +
labs(title = "hierarchical cluster of subscales",
subtitle = "using mean scores by site")
clust_subscales <- hclust(dist(cor_by_site))
ggdendrogram(clust_subscales) +
labs(title = "hierarchical cluster of subscales",
subtitle = "using mean scores by site")
clust_subscales <- hclust(dist(t(cor_by_site)))
ggdendrogram(clust_subscales) +
labs(title = "hierarchical cluster of subscales",
subtitle = "using mean subscale scores by site")
clust_subscales <- hclust(dist(cor_by_site))
ggdendrogram(clust_subscales) +
labs(title = "hierarchical cluster of sites",
subtitle = "using mean subscale scores by site")
clust_subscales <- hclust(dist(cor_by_site))
ggdendrogram(clust_subscales) +
labs(title = "hierarchical cluster of sites",
subtitle = "using mean subscale scores by site")
d_long_subscale %>%
filter(packet == 2, !is.na(sum_score)) %>%
spread(subscale, sum_score) %>%
select(-c(ctry, wher, recr, whoc, attn)) %>%
mutate(subj = paste(subj, packet, version, sep = "_")) %>%
select(-packet, -version) %>%
distinct() %>%
remove_rownames() %>%
column_to_rownames("subj") %>%
cor(use = "pairwise.complete.obs") %>%
data.frame() %>%
rownames_to_column("subscaleA") %>%
gather(subscaleB, cor, -subscaleA) %>%
ggplot(aes(x = subscaleA, y = subscaleB, fill = cor, label = round2(cor))) +
geom_tile() +
geom_text(size = 3) +
scale_fill_distiller(guide = guide_colorbar(barheight = 6),
palette = "RdYlBu", limits = c(-1, 1)) +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
labs(title = "PACKET 2: correlations among subscales",
subtitle = "using pairwise complete observations",
x = "",
y = "")
ggplot(d_long_subscale_boot,
aes(x = ctry, y = Mean, color = ctry)) +
facet_wrap(~ reorder(interaction(packet, subscale, sep = ": "),
as.numeric(factor(packet))),
ncol = 5, scales = "free") +
geom_pointrange(aes(ymin = Lower, ymax = Upper)) +
geom_text(aes(label = paste0("(n=", n, ")"), y = Lower),
size = 2, nudge_x = 0.15, hjust = 0) +
scale_x_discrete(expand = c(0, 1)) +
scale_color_brewer(palette = "Dark2") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1),
legend.position = "top") +
labs(title = "mean scores by site",
subtitle = "ordered by packet\nerror bars are bootstrapped 95% confidence intervals",
x = "site", color = "site",
y = "mean score (range varies by subscale)")
ggplot(d_long_subscale_boot,
aes(x = ctry, y = Mean, color = ctry)) +
facet_wrap(~ reorder(interaction(packet, subscale, sep = ": "),
as.numeric(factor(packet))),
ncol = 5, scales = "free") +
geom_pointrange(aes(ymin = Lower, ymax = Upper)) +
geom_text(aes(label = paste0("(n=", n, ")"), y = Lower),
size = 2, nudge_x = 0.15, hjust = 0) +
scale_x_discrete(expand = c(0, 1)) +
scale_color_brewer(palette = "Dark2") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1),
legend.position = "top") +
labs(title = "mean scores by site",
subtitle = "ordered by packet\nerror bars are bootstrapped 95% confidence intervals",
x = "site", color = "site",
y = "mean score (range varies by subscale)")
ggplot(d_long_subscale_boot,
aes(x = ctry, y = Mean, color = ctry)) +
facet_wrap(~ reorder(interaction(packet, subscale, sep = ": "),
as.numeric(factor(packet))),
ncol = 5, scales = "free") +
geom_pointrange(aes(ymin = Lower, ymax = Upper)) +
geom_text(aes(label = paste0("(n=", n, ")"), y = Lower),
size = 2, nudge_x = 0.15, hjust = 0) +
scale_x_discrete(expand = c(0, 1)) +
scale_color_brewer(palette = "Dark2") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1),
legend.position = "top") +
labs(title = "mean scores by site",
subtitle = "ordered by packet\nerror bars are bootstrapped 95% confidence intervals",
x = "site", color = "site",
y = "mean score (range varies by subscale)")
ggplot(d_long_subscale_boot %>%
mutate(packet = gsub("P", "packet ", packet)),
aes(x = ctry, y = Mean, color = ctry)) +
facet_wrap(~ reorder(interaction(packet, subscale, sep = ": "),
as.numeric(factor(packet))),
ncol = 5, scales = "free") +
geom_pointrange(aes(ymin = Lower, ymax = Upper)) +
geom_text(aes(label = paste0("(n=", n, ")"), y = Lower),
size = 2, nudge_x = 0.15, hjust = 0) +
scale_x_discrete(expand = c(0, 1)) +
scale_color_brewer(palette = "Dark2") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1),
legend.position = "top") +
labs(title = "mean scores by site",
subtitle = "ordered by packet\nerror bars are bootstrapped 95% confidence intervals",
x = "site", color = "site",
y = "mean score (range varies by subscale)")
d_long_subscale_boot
ggplot(d_long_subscale_boot %>%
mutate(packet = gsub("packet ", "P", packet)),
aes(x = ctry, y = Mean, color = ctry)) +
facet_wrap(~ reorder(interaction(packet, subscale, sep = ": "),
as.numeric(factor(packet))),
ncol = 5, scales = "free") +
geom_pointrange(aes(ymin = Lower, ymax = Upper)) +
geom_text(aes(label = paste0("(n=", n, ")"), y = Lower),
size = 2, nudge_x = 0.15, hjust = 0) +
scale_x_discrete(expand = c(0, 1)) +
scale_color_brewer(palette = "Dark2") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1),
legend.position = "top") +
labs(title = "mean scores by site",
subtitle = "ordered by packet\nerror bars are bootstrapped 95% confidence intervals",
x = "site", color = "site",
y = "mean score (range varies by subscale)")
ggplot(d_long_subscale_boot %>%
mutate(packet = gsub("packet ", "P", packet)),
aes(x = ctry, y = Mean, color = ctry)) +
facet_wrap(~ reorder(interaction(packet, subscale, sep = ": "),
as.numeric(factor(packet))),
ncol = 5, scales = "free") +
geom_pointrange(aes(ymin = Lower, ymax = Upper)) +
geom_text(aes(label = paste0("(n=", n, ")"), y = Lower),
size = 2, nudge_x = 0.15, hjust = 0) +
scale_x_discrete(expand = c(0, 1)) +
scale_color_brewer(palette = "Dark2") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1),
legend.position = "top") +
labs(title = "mean scores by site",
subtitle = "ordered by packet\nerror bars are bootstrapped 95% confidence intervals",
x = "site", color = "site",
y = "mean score (range varies by subscale)")
ggplot(d_long_subscale_boot %>%
mutate(packet = gsub("packet ", "P", packet)),
aes(x = ctry, y = Mean, color = ctry)) +
facet_wrap(~ reorder(interaction(packet, subscale, sep = ": "),
as.numeric(factor(packet))),
ncol = 5, scales = "free") +
geom_pointrange(aes(ymin = Lower, ymax = Upper)) +
geom_text(aes(label = paste0("(n=", n, ")"), y = Lower),
size = 2, nudge_x = 0.15, hjust = 0) +
scale_x_discrete(expand = c(0, 1)) +
scale_color_brewer(palette = "Dark2") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 90, hjust = 1),
legend.position = "top") +
labs(title = "mean scores by site",
subtitle = "ordered by packet (P1, P2, P3)\nerror bars are bootstrapped 95% confidence intervals",
x = "site", color = "site",
y = "mean score (range varies by subscale)")
